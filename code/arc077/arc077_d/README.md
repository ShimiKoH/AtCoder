## [AtCoder Regular Contest 077_D 11](https://atcoder.jp/contests/arc077/tasks/arc077_b)

## 問題
$1, \dots, n$ の $n$ 個の整数からなる長さ $n + 1$ の数列 $a_1, a_2, \dots, a_{n+1}$ が与えられる。この数列には $1, \dots n$ のどの整数も必ず $1$ 回以上出現することが分かっている。  
$k = 1, \dots , n+1$ のそれぞれについて、与えられた数列の長さ $k$ の（連続とは限らない）部分列の個数を求め、 $10^9 + 7$ で割ったあまりを出力しなさい。

## 注意
- $2$ つの部分列が数列として同じであれば、元の数列での位置が異なっていたとしても、 $1$ 通りと数える。
- 数列 $a$ の長さ $k$ の部分列とは、 $a$ の要素のうち $k$ 個を選んで、それらを順番を変えずに取り出して並べた数列のことを指す。

## 制約
- $1 \leqq n \leqq 10^5$
- $1 \leqq a_i \leqq n$
- $1, \dots , n$ のどの整数も必ず数列に出現する。
- $n, a_i$ は整数である。

## 入力
入力は以下の形式で標準入力から与えられる。

$$
\begin{matrix}
n \\
a_1 & a_2 & \dots & a_{n+1}
\end{matrix}
$$

## 出力
答えを $n+1$ 行に出力せよ。 $k$ 行目には、長さ $k$ の部分列の個数を $10^9 + 7$ で割ったあまりを出力せよ。

***

## 解き方
数列 $a$ には $n+1$ 個の項があり、 $n$ 種類の数によって構成されている。鳩の巣原理を用いると、あるただ一つの数のみ $2$ つ出現していることが分かる。この数を $p$ 、項を $a_q, a_{q^{\prime}}$ とする。部分数列で抽出した $k$ 個の数の組み合わせは、ある条件のとき重複する。
- $p$ を含まない数列  
    $\rightarrow$ 異なる $n-1$ 個から選ぶので、重複しない
- $p$ を $1$ つだけ含む  
    $\rightarrow$ $a_q, a_{q^{\prime}}$ の間の項を使わ**ない**ことで、**重複する**。  
    間の項 $a_m$ を用いることで $a_q a_m, a_m a_{q^{\prime}}$ という異なる $2$ つの数列が作れるが、外側の項を用いることで、 $a_{o1} a_q a_{o2}, a_{o1} a_{q^{\prime}} a_{o2}$ という見かけは同じ数列が作られる。
- $p$ を $2$ つとも含む  
    $\rightarrow$ これも $p$ を含まない数列同様に重複しない

つまり、重複を許して $k$ 個選ぶ組み合わせから、重複分を引けばよい。


数Aあたりで学んだ、組み合わせ *combination* を用いることで、一般化できる。  
- $n+1$ から重複を許して $k$ 個選ぶ。  

$$
_{n + 1} \mathrm{C}_k
$$

- 重複分
    $a_q, a_{q^{\prime}}$ の外側の $(n+1)-(q^{\prime}-q+1) = n+q-q^{\prime}$ 個から $k-1$ 個を選ぶ。

$$
_{n+q-q^{\prime}}\mathrm{C}_{k-1}
$$

ここで、整数 $s, t (0 \leqq t \leqq s)$ に対して

$$
_s\mathrm{C}_t = \frac{s!}{t!(s-t)!}
$$

であるが、この問題で扱う $n$ は大きく、分数計算の後に $10^9+7$ で割るのでは、不具合が起きかねない。そのため、階乗計算の時点で、動的計画法( $dp$ 法)を用いて、演算を簡単なものに置き換える必要がある。

[合同式における剰余の演算](../../../algorithm/modulo.md#数値演算) から、 $k$ で割るときの演算を $f(k)$ を掛ける演算に置き換えられることが分かる。

$$
f(1) = 1 \\
f(n) \equiv -q \times f(r) \quad (\bmod \ p)
$$

ここでの $f(n)$ とは、「 $p$ を法とした合同式において、 $p$ と互いにその任意の数 $A$ について $n$ で割ることと同じ結果を得るために、 $A$ に掛けることになる数」である。階乗で割ることは、以下のように計算できる。

$$
\begin{align*}
\frac{A}{n!} & \equiv \frac{A}{1 \cdot 2 \cdot \cdots \cdot n} \\
& \equiv A \cdot f(1) \cdot f(2) \cdot \cdots \cdot f(n) 
\end{align*}
$$

つまり、以下の配列を用意することで、 ${}_s\textrm{C}_t$ を、 $\mathcal{O}(1)$ で求めることができる。
1. $i$ の階乗を $p$ で割った剰余を格納した配列 _factorial_
2. $f(i)$ を格納した配列 _inversion_
3. 2をもとに作った $f(i!)$ を格納した配列 _factorial_inversion_ 

## 計算量
入力に $\mathcal{O}(n)$  
配列の作成に $\mathcal{O}(n)$  
計算と出力に $\mathcal{O}(n)$  